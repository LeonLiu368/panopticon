{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Users/leonliu/projects/tartanhacks/lib/supabase-client.ts"],"sourcesContent":["// Lightweight in-memory Supabase mock so the app runs with zero external services.\n// Supports the minimal chainable API surface we use in the UI and route handlers.\n\ntype TableName =\n  | 'incidents'\n  | 'police_stations'\n  | 'units'\n  | 'dispatches'\n  | 'checkpoints'\n  | 'unit_stats';\n\n// Seed data for local/offline demo\nconst db: Record<TableName, any[]> = {\n  incidents: [\n    {\n      id: 'robbery-forbes-morewood',\n      name: 'Robbery at Forbes & Morewood',\n      status: 'active',\n      priority: 'high',\n      risk: 'high',\n      lat: 40.4427,\n      lon: -79.9425,\n      containment: 15,\n      description: 'Reported robbery near CMU campus',\n      incident_type: 'robbery',\n      start_time: new Date().toISOString(),\n      last_update: new Date().toISOString(),\n      reported_by: 'Dispatch',\n    },\n    {\n      id: 'traffic-cmu',\n      name: 'Multi-vehicle collision on Fifth Ave',\n      status: 'active',\n      priority: 'medium',\n      risk: 'medium',\n      lat: 40.4433,\n      lon: -79.9490,\n      containment: 35,\n      description: '3-car collision blocking two lanes',\n      incident_type: 'traffic',\n      start_time: new Date().toISOString(),\n      last_update: new Date().toISOString(),\n      reported_by: '911',\n    },\n  ],\n  police_stations: [\n    { id: 1, name: 'Station 1 - Downtown', city: 'Pittsburgh', county: 'Allegheny', lat: 40.4406, lon: -79.9959, created_at: new Date().toISOString() },\n    { id: 2, name: 'Station 2 - North', city: 'Pittsburgh', county: 'Allegheny', lat: 40.4500, lon: -79.9500, created_at: new Date().toISOString() },\n    { id: 3, name: 'Station 3 - South', city: 'Pittsburgh', county: 'Allegheny', lat: 40.4300, lon: -79.9800, created_at: new Date().toISOString() },\n  ],\n  units: [],\n  dispatches: [],\n  checkpoints: [],\n  unit_stats: [],\n};\n\n// Create three units per station\ndb.police_stations.forEach((station) => {\n  Array.from({ length: 3 }).forEach((_, idx) => {\n    db.units.push({\n      id: `${station.id}-unit-${idx + 1}`,\n      station_id: station.id,\n      unit_number: `Unit ${station.id}-${idx + 1}`,\n      unit_type: idx === 2 ? 'k9' : 'patrol',\n      status: 'available',\n      current_lat: station.lat,\n      current_lon: station.lon,\n      incident_id: null,\n      dispatched_at: null,\n      arrived_at: null,\n      created_at: new Date().toISOString(),\n      updated_at: new Date().toISOString(),\n    });\n  });\n});\n\n// Extra pre-positioned patrols around CMU / Oakland for demo visibility\ndb.units.push(\n  {\n    id: 'patrol-cmu-1',\n    station_id: 1,\n    unit_number: 'Patrol CMU-1',\n    unit_type: 'patrol',\n    status: 'available',\n    current_lat: 40.4445,\n    current_lon: -79.9432,\n    incident_id: null,\n    dispatched_at: null,\n    arrived_at: null,\n    created_at: new Date().toISOString(),\n    updated_at: new Date().toISOString(),\n  },\n  {\n    id: 'traffic-forbes-1',\n    station_id: 1,\n    unit_number: 'Traffic Forbes',\n    unit_type: 'traffic',\n    status: 'available',\n    current_lat: 40.4429,\n    current_lon: -79.9418,\n    incident_id: null,\n    dispatched_at: null,\n    arrived_at: null,\n    created_at: new Date().toISOString(),\n    updated_at: new Date().toISOString(),\n  },\n  {\n    id: 'k9-shadyside',\n    station_id: 2,\n    unit_number: 'K9 Shadyside',\n    unit_type: 'k9',\n    status: 'available',\n    current_lat: 40.4545,\n    current_lon: -79.9320,\n    incident_id: null,\n    dispatched_at: null,\n    arrived_at: null,\n    created_at: new Date().toISOString(),\n    updated_at: new Date().toISOString(),\n  }\n);\n\n// Helper to compute unit_stats view on the fly\nconst computeUnitStats = () => {\n  return db.police_stations.map((ps) => {\n    const units = db.units.filter((u) => u.station_id === ps.id);\n    return {\n      station_id: ps.id,\n      station_name: ps.name,\n      available_units: units.filter((u) => u.status === 'available').length,\n      dispatched_units: units.filter((u) => ['dispatched', 'en_route'].includes(u.status)).length,\n      on_scene_units: units.filter((u) => u.status === 'on_scene').length,\n      total_units: units.length,\n    };\n  });\n};\n\n// Utility clone\nconst clone = <T>(v: T): T => JSON.parse(JSON.stringify(v));\n\n// Reset mock state to initial availability (useful on app load/hot reload)\nexport const resetMockState = () => {\n  db.units = db.units.map((u) => ({\n    ...u,\n    status: 'available',\n    incident_id: null,\n    dispatched_at: null,\n    arrived_at: null,\n    updated_at: new Date().toISOString(),\n  }));\n  db.dispatches = [];\n};\n\n// Query builder\nfunction buildSelect(table: TableName, rows: any[]) {\n  let working = [...rows];\n\n  const api: any = {\n    select: (_cols: string = '*') => api,\n    eq: (col: string, val: any) => {\n      working = working.filter((r) => r[col] === val);\n      return api;\n    },\n    in: (col: string, vals: any[]) => {\n      working = working.filter((r) => vals.includes(r[col]));\n      return api;\n    },\n    order: (col: string, opts: { ascending?: boolean } = {}) => {\n      const asc = opts.ascending !== false;\n      working = [...working].sort((a, b) => {\n        if (a[col] === b[col]) return 0;\n        return (a[col] > b[col] ? 1 : -1) * (asc ? 1 : -1);\n      });\n      return api;\n    },\n    limit: (n: number) => {\n      working = working.slice(0, n);\n      return Promise.resolve({ data: clone(working), error: null });\n    },\n    then: (resolve: any, reject: any) =>\n      Promise.resolve({ data: clone(working), error: null }).then(resolve, reject),\n  };\n\n  return api;\n}\n\nfunction buildUpdate(table: TableName, values: Record<string, any>) {\n  return {\n    eq: (col: string, val: any) => {\n      const updated: any[] = [];\n      db[table] = db[table].map((row) => {\n        if (row[col] === val) {\n          const next = { ...row, ...values, updated_at: new Date().toISOString() };\n          updated.push(next);\n          return next;\n        }\n        return row;\n      });\n      return Promise.resolve({ data: clone(updated), error: null });\n    },\n    in: (col: string, vals: any[]) => {\n      const updated: any[] = [];\n      db[table] = db[table].map((row) => {\n        if (vals.includes(row[col])) {\n          const next = { ...row, ...values, updated_at: new Date().toISOString() };\n          updated.push(next);\n          return next;\n        }\n        return row;\n      });\n      return Promise.resolve({ data: clone(updated), error: null });\n    },\n  };\n}\n\nfunction buildInsert(table: TableName, payload: any | any[]) {\n  const items = Array.isArray(payload) ? payload : [payload];\n  const withIds = items.map((item) => ({\n    ...item,\n    id: item.id || crypto.randomUUID?.() || `id-${Math.random().toString(36).slice(2, 8)}`,\n    created_at: new Date().toISOString(),\n    updated_at: new Date().toISOString(),\n  }));\n  db[table].push(...withIds);\n  return Promise.resolve({ data: clone(withIds), error: null });\n}\n\nfunction buildDelete(table: TableName) {\n  return {\n    eq: (col: string, val: any) => {\n      const removed = db[table].filter((row) => row[col] === val);\n      db[table] = db[table].filter((row) => row[col] !== val);\n      return Promise.resolve({ data: clone(removed), error: null });\n    },\n  };\n}\n\nconst mockChannel = () => {\n  const ch: any = {\n    on: () => ch,\n    subscribe: () => ch,\n    unsubscribe: () => {},\n  };\n  return ch;\n};\n\nexport const supabase: any = {\n  from: (table: TableName) => {\n    if (table === 'unit_stats') {\n      return buildSelect(table, computeUnitStats());\n    }\n    return {\n      select: (_cols: string = '*') => buildSelect(table, db[table]),\n      update: (values: Record<string, any>) => buildUpdate(table, values),\n      insert: (payload: any | any[]) => buildInsert(table, payload),\n      delete: () => buildDelete(table),\n    };\n  },\n  channel: (_name: string) => mockChannel(),\n  removeChannel: (_ch: any) => {},\n  // Expose db for debugging in dev tools\n  __data: db,\n  // Helper to mutate units in-memory (used by animations)\n  __updateUnitPosition: (id: string, lat: number, lon: number, status?: string) => {\n    db.units = db.units.map((u) =>\n      u.id === id\n        ? {\n            ...u,\n            current_lat: lat,\n            current_lon: lon,\n            status: status || u.status,\n            updated_at: new Date().toISOString(),\n          }\n        : u\n    );\n  },\n};\n"],"names":[],"mappings":"AAAA,mFAAmF;AACnF,kFAAkF;;;;;;;AAUlF,mCAAmC;AACnC,MAAM,KAA+B;IACnC,WAAW;QACT;YACE,IAAI;YACJ,MAAM;YACN,QAAQ;YACR,UAAU;YACV,MAAM;YACN,KAAK;YACL,KAAK,CAAC;YACN,aAAa;YACb,aAAa;YACb,eAAe;YACf,YAAY,IAAI,OAAO,WAAW;YAClC,aAAa,IAAI,OAAO,WAAW;YACnC,aAAa;QACf;QACA;YACE,IAAI;YACJ,MAAM;YACN,QAAQ;YACR,UAAU;YACV,MAAM;YACN,KAAK;YACL,KAAK,CAAC;YACN,aAAa;YACb,aAAa;YACb,eAAe;YACf,YAAY,IAAI,OAAO,WAAW;YAClC,aAAa,IAAI,OAAO,WAAW;YACnC,aAAa;QACf;KACD;IACD,iBAAiB;QACf;YAAE,IAAI;YAAG,MAAM;YAAwB,MAAM;YAAc,QAAQ;YAAa,KAAK;YAAS,KAAK,CAAC;YAAS,YAAY,IAAI,OAAO,WAAW;QAAG;QAClJ;YAAE,IAAI;YAAG,MAAM;YAAqB,MAAM;YAAc,QAAQ;YAAa,KAAK;YAAS,KAAK,CAAC;YAAS,YAAY,IAAI,OAAO,WAAW;QAAG;QAC/I;YAAE,IAAI;YAAG,MAAM;YAAqB,MAAM;YAAc,QAAQ;YAAa,KAAK;YAAS,KAAK,CAAC;YAAS,YAAY,IAAI,OAAO,WAAW;QAAG;KAChJ;IACD,OAAO,EAAE;IACT,YAAY,EAAE;IACd,aAAa,EAAE;IACf,YAAY,EAAE;AAChB;AAEA,iCAAiC;AACjC,GAAG,eAAe,CAAC,OAAO,CAAC,CAAC;IAC1B,MAAM,IAAI,CAAC;QAAE,QAAQ;IAAE,GAAG,OAAO,CAAC,CAAC,GAAG;QACpC,GAAG,KAAK,CAAC,IAAI,CAAC;YACZ,IAAI,GAAG,QAAQ,EAAE,CAAC,MAAM,EAAE,MAAM,GAAG;YACnC,YAAY,QAAQ,EAAE;YACtB,aAAa,CAAC,KAAK,EAAE,QAAQ,EAAE,CAAC,CAAC,EAAE,MAAM,GAAG;YAC5C,WAAW,QAAQ,IAAI,OAAO;YAC9B,QAAQ;YACR,aAAa,QAAQ,GAAG;YACxB,aAAa,QAAQ,GAAG;YACxB,aAAa;YACb,eAAe;YACf,YAAY;YACZ,YAAY,IAAI,OAAO,WAAW;YAClC,YAAY,IAAI,OAAO,WAAW;QACpC;IACF;AACF;AAEA,wEAAwE;AACxE,GAAG,KAAK,CAAC,IAAI,CACX;IACE,IAAI;IACJ,YAAY;IACZ,aAAa;IACb,WAAW;IACX,QAAQ;IACR,aAAa;IACb,aAAa,CAAC;IACd,aAAa;IACb,eAAe;IACf,YAAY;IACZ,YAAY,IAAI,OAAO,WAAW;IAClC,YAAY,IAAI,OAAO,WAAW;AACpC,GACA;IACE,IAAI;IACJ,YAAY;IACZ,aAAa;IACb,WAAW;IACX,QAAQ;IACR,aAAa;IACb,aAAa,CAAC;IACd,aAAa;IACb,eAAe;IACf,YAAY;IACZ,YAAY,IAAI,OAAO,WAAW;IAClC,YAAY,IAAI,OAAO,WAAW;AACpC,GACA;IACE,IAAI;IACJ,YAAY;IACZ,aAAa;IACb,WAAW;IACX,QAAQ;IACR,aAAa;IACb,aAAa,CAAC;IACd,aAAa;IACb,eAAe;IACf,YAAY;IACZ,YAAY,IAAI,OAAO,WAAW;IAClC,YAAY,IAAI,OAAO,WAAW;AACpC;AAGF,+CAA+C;AAC/C,MAAM,mBAAmB;IACvB,OAAO,GAAG,eAAe,CAAC,GAAG,CAAC,CAAC;QAC7B,MAAM,QAAQ,GAAG,KAAK,CAAC,MAAM,CAAC,CAAC,IAAM,EAAE,UAAU,KAAK,GAAG,EAAE;QAC3D,OAAO;YACL,YAAY,GAAG,EAAE;YACjB,cAAc,GAAG,IAAI;YACrB,iBAAiB,MAAM,MAAM,CAAC,CAAC,IAAM,EAAE,MAAM,KAAK,aAAa,MAAM;YACrE,kBAAkB,MAAM,MAAM,CAAC,CAAC,IAAM;oBAAC;oBAAc;iBAAW,CAAC,QAAQ,CAAC,EAAE,MAAM,GAAG,MAAM;YAC3F,gBAAgB,MAAM,MAAM,CAAC,CAAC,IAAM,EAAE,MAAM,KAAK,YAAY,MAAM;YACnE,aAAa,MAAM,MAAM;QAC3B;IACF;AACF;AAEA,gBAAgB;AAChB,MAAM,QAAQ,CAAI,IAAY,KAAK,KAAK,CAAC,KAAK,SAAS,CAAC;AAGjD,MAAM,iBAAiB;IAC5B,GAAG,KAAK,GAAG,GAAG,KAAK,CAAC,GAAG,CAAC,CAAC,IAAM,CAAC;YAC9B,GAAG,CAAC;YACJ,QAAQ;YACR,aAAa;YACb,eAAe;YACf,YAAY;YACZ,YAAY,IAAI,OAAO,WAAW;QACpC,CAAC;IACD,GAAG,UAAU,GAAG,EAAE;AACpB;AAEA,gBAAgB;AAChB,SAAS,YAAY,KAAgB,EAAE,IAAW;IAChD,IAAI,UAAU;WAAI;KAAK;IAEvB,MAAM,MAAW;QACf,QAAQ,CAAC,QAAgB,GAAG,GAAK;QACjC,IAAI,CAAC,KAAa;YAChB,UAAU,QAAQ,MAAM,CAAC,CAAC,IAAM,CAAC,CAAC,IAAI,KAAK;YAC3C,OAAO;QACT;QACA,IAAI,CAAC,KAAa;YAChB,UAAU,QAAQ,MAAM,CAAC,CAAC,IAAM,KAAK,QAAQ,CAAC,CAAC,CAAC,IAAI;YACpD,OAAO;QACT;QACA,OAAO,CAAC,KAAa,OAAgC,CAAC,CAAC;YACrD,MAAM,MAAM,KAAK,SAAS,KAAK;YAC/B,UAAU;mBAAI;aAAQ,CAAC,IAAI,CAAC,CAAC,GAAG;gBAC9B,IAAI,CAAC,CAAC,IAAI,KAAK,CAAC,CAAC,IAAI,EAAE,OAAO;gBAC9B,OAAO,CAAC,CAAC,CAAC,IAAI,GAAG,CAAC,CAAC,IAAI,GAAG,IAAI,CAAC,CAAC,IAAI,CAAC,MAAM,IAAI,CAAC,CAAC;YACnD;YACA,OAAO;QACT;QACA,OAAO,CAAC;YACN,UAAU,QAAQ,KAAK,CAAC,GAAG;YAC3B,OAAO,QAAQ,OAAO,CAAC;gBAAE,MAAM,MAAM;gBAAU,OAAO;YAAK;QAC7D;QACA,MAAM,CAAC,SAAc,SACnB,QAAQ,OAAO,CAAC;gBAAE,MAAM,MAAM;gBAAU,OAAO;YAAK,GAAG,IAAI,CAAC,SAAS;IACzE;IAEA,OAAO;AACT;AAEA,SAAS,YAAY,KAAgB,EAAE,MAA2B;IAChE,OAAO;QACL,IAAI,CAAC,KAAa;YAChB,MAAM,UAAiB,EAAE;YACzB,EAAE,CAAC,MAAM,GAAG,EAAE,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;gBACzB,IAAI,GAAG,CAAC,IAAI,KAAK,KAAK;oBACpB,MAAM,OAAO;wBAAE,GAAG,GAAG;wBAAE,GAAG,MAAM;wBAAE,YAAY,IAAI,OAAO,WAAW;oBAAG;oBACvE,QAAQ,IAAI,CAAC;oBACb,OAAO;gBACT;gBACA,OAAO;YACT;YACA,OAAO,QAAQ,OAAO,CAAC;gBAAE,MAAM,MAAM;gBAAU,OAAO;YAAK;QAC7D;QACA,IAAI,CAAC,KAAa;YAChB,MAAM,UAAiB,EAAE;YACzB,EAAE,CAAC,MAAM,GAAG,EAAE,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;gBACzB,IAAI,KAAK,QAAQ,CAAC,GAAG,CAAC,IAAI,GAAG;oBAC3B,MAAM,OAAO;wBAAE,GAAG,GAAG;wBAAE,GAAG,MAAM;wBAAE,YAAY,IAAI,OAAO,WAAW;oBAAG;oBACvE,QAAQ,IAAI,CAAC;oBACb,OAAO;gBACT;gBACA,OAAO;YACT;YACA,OAAO,QAAQ,OAAO,CAAC;gBAAE,MAAM,MAAM;gBAAU,OAAO;YAAK;QAC7D;IACF;AACF;AAEA,SAAS,YAAY,KAAgB,EAAE,OAAoB;IACzD,MAAM,QAAQ,MAAM,OAAO,CAAC,WAAW,UAAU;QAAC;KAAQ;IAC1D,MAAM,UAAU,MAAM,GAAG,CAAC,CAAC,OAAS,CAAC;YACnC,GAAG,IAAI;YACP,IAAI,KAAK,EAAE,IAAI,OAAO,UAAU,QAAQ,CAAC,GAAG,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,KAAK,CAAC,GAAG,IAAI;YACtF,YAAY,IAAI,OAAO,WAAW;YAClC,YAAY,IAAI,OAAO,WAAW;QACpC,CAAC;IACD,EAAE,CAAC,MAAM,CAAC,IAAI,IAAI;IAClB,OAAO,QAAQ,OAAO,CAAC;QAAE,MAAM,MAAM;QAAU,OAAO;IAAK;AAC7D;AAEA,SAAS,YAAY,KAAgB;IACnC,OAAO;QACL,IAAI,CAAC,KAAa;YAChB,MAAM,UAAU,EAAE,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,MAAQ,GAAG,CAAC,IAAI,KAAK;YACvD,EAAE,CAAC,MAAM,GAAG,EAAE,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,MAAQ,GAAG,CAAC,IAAI,KAAK;YACnD,OAAO,QAAQ,OAAO,CAAC;gBAAE,MAAM,MAAM;gBAAU,OAAO;YAAK;QAC7D;IACF;AACF;AAEA,MAAM,cAAc;IAClB,MAAM,KAAU;QACd,IAAI,IAAM;QACV,WAAW,IAAM;QACjB,aAAa,KAAO;IACtB;IACA,OAAO;AACT;AAEO,MAAM,WAAgB;IAC3B,MAAM,CAAC;QACL,IAAI,UAAU,cAAc;YAC1B,OAAO,YAAY,OAAO;QAC5B;QACA,OAAO;YACL,QAAQ,CAAC,QAAgB,GAAG,GAAK,YAAY,OAAO,EAAE,CAAC,MAAM;YAC7D,QAAQ,CAAC,SAAgC,YAAY,OAAO;YAC5D,QAAQ,CAAC,UAAyB,YAAY,OAAO;YACrD,QAAQ,IAAM,YAAY;QAC5B;IACF;IACA,SAAS,CAAC,QAAkB;IAC5B,eAAe,CAAC,OAAc;IAC9B,uCAAuC;IACvC,QAAQ;IACR,wDAAwD;IACxD,sBAAsB,CAAC,IAAY,KAAa,KAAa;QAC3D,GAAG,KAAK,GAAG,GAAG,KAAK,CAAC,GAAG,CAAC,CAAC,IACvB,EAAE,EAAE,KAAK,KACL;gBACE,GAAG,CAAC;gBACJ,aAAa;gBACb,aAAa;gBACb,QAAQ,UAAU,EAAE,MAAM;gBAC1B,YAAY,IAAI,OAAO,WAAW;YACpC,IACA;IAER;AACF","debugId":null}},
    {"offset": {"line": 356, "column": 0}, "map": {"version":3,"sources":["file:///Users/leonliu/projects/tartanhacks/app/api/update-routes/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { supabase } from '@/lib/supabase-client';\n\n// GET: Retrieve latest route updates\nexport async function GET(request: NextRequest) {\n  try {\n    // Get route updates from last 5 minutes\n    const fiveMinutesAgo = new Date(Date.now() - 5 * 60 * 1000).toISOString();\n    \n    const { data: routeUpdates, error: routeError } = await supabase\n      .from('route_updates')\n      .select('*')\n      .gte('created_at', fiveMinutesAgo)\n      .order('created_at', { ascending: false });\n\n    const { data: evacuations, error: evacError } = await supabase\n      .from('evacuation_zones')\n      .select('*')\n      .gte('recommended_at', fiveMinutesAgo)\n      .order('recommended_at', { ascending: false });\n\n    return NextResponse.json({\n      routes: routeUpdates || [],\n      evacuations: evacuations || [],\n      timestamp: new Date().toISOString()\n    });\n  } catch (error) {\n    console.error('Error fetching route updates:', error);\n    return NextResponse.json(\n      { error: 'Failed to fetch routes', details: error instanceof Error ? error.message : 'Unknown error' },\n      { status: 500 }\n    );\n  }\n}\n\n// POST: Create new route update from AI agent\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { station_id, new_route, reason, original_route, risk_score } = body;\n\n    // Validate required fields\n    if (!station_id || !new_route) {\n      return NextResponse.json(\n        { error: 'Missing required fields: station_id and new_route are required' },\n        { status: 400 }\n      );\n    }\n\n    // Insert route update into Supabase\n    const { data, error } = await supabase\n      .from('route_updates')\n      .insert({\n        station_id,\n        original_route: original_route || null,\n        new_route,\n        reason: reason || 'AI-recommended route adjustment',\n        risk_score: risk_score || null\n      })\n      .select()\n      .single();\n\n    if (error) {\n      return NextResponse.json(\n        { error: 'Failed to save route update', details: error.message },\n        { status: 500 }\n      );\n    }\n\n    // Notify VAPI about the route update\n    try {\n      await fetch(`${process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000'}/api/vapi-webhook`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          action: 'route_update',\n          message: reason || `Route updated for station ${station_id}`,\n          data: { station_id, route: new_route }\n        })\n      });\n    } catch (vapiError) {\n      console.warn('Failed to notify VAPI:', vapiError);\n      // Don't fail the route update if VAPI notification fails\n    }\n\n    return NextResponse.json({\n      success: true,\n      route_update: data,\n      message: 'Route update saved successfully'\n    });\n  } catch (error) {\n    console.error('Error creating route update:', error);\n    return NextResponse.json(\n      { error: 'Internal server error', details: error instanceof Error ? error.message : 'Unknown error' },\n      { status: 500 }\n    );\n  }\n}\n\n// POST to /evacuation endpoint: Create evacuation zone recommendation\nexport async function PUT(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { fire_id, zone_name, polygon } = body;\n\n    if (!fire_id || !polygon) {\n      return NextResponse.json(\n        { error: 'Missing required fields: fire_id and polygon are required' },\n        { status: 400 }\n      );\n    }\n\n    const { data, error } = await supabase\n      .from('evacuation_zones')\n      .insert({\n        fire_id,\n        zone_name,\n        polygon\n      })\n      .select()\n      .single();\n\n    if (error) {\n      return NextResponse.json(\n        { error: 'Failed to save evacuation zone', details: error.message },\n        { status: 500 }\n      );\n    }\n\n    // Notify VAPI\n    try {\n      await fetch(`${process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000'}/api/vapi-webhook`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          action: 'evacuation',\n          message: `Evacuation recommended for ${zone_name || 'affected area'}`,\n          data: { fire_id, zone: polygon }\n        })\n      });\n    } catch (vapiError) {\n      console.warn('Failed to notify VAPI:', vapiError);\n    }\n\n    return NextResponse.json({\n      success: true,\n      evacuation_zone: data,\n      message: 'Evacuation zone created successfully'\n    });\n  } catch (error) {\n    console.error('Error creating evacuation zone:', error);\n    return NextResponse.json(\n      { error: 'Internal server error', details: error instanceof Error ? error.message : 'Unknown error' },\n      { status: 500 }\n    );\n  }\n}\n\n"],"names":[],"mappings":"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","debugId":null}}]
}