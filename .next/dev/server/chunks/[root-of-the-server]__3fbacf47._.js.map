{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Users/leonliu/projects/tartanhacks/lib/supabase-client.ts"],"sourcesContent":["// Lightweight in-memory Supabase mock so the app runs with zero external services.\n// Supports the minimal chainable API surface we use in the UI and route handlers.\n\ntype TableName =\n  | 'incidents'\n  | 'police_stations'\n  | 'units'\n  | 'dispatches'\n  | 'checkpoints'\n  | 'unit_stats';\n\n// Seed data for local/offline demo\nconst db: Record<TableName, any[]> = {\n  incidents: [\n    {\n      id: 'robbery-forbes-morewood',\n      name: 'Robbery at Forbes & Morewood',\n      status: 'active',\n      priority: 'high',\n      risk: 'high',\n      lat: 40.4427,\n      lon: -79.9425,\n      containment: 15,\n      description: 'Reported robbery near CMU campus',\n      incident_type: 'robbery',\n      start_time: new Date().toISOString(),\n      last_update: new Date().toISOString(),\n      reported_by: 'Dispatch',\n    },\n    {\n      id: 'traffic-cmu',\n      name: 'Multi-vehicle collision on Fifth Ave',\n      status: 'active',\n      priority: 'medium',\n      risk: 'medium',\n      lat: 40.4433,\n      lon: -79.9490,\n      containment: 35,\n      description: '3-car collision blocking two lanes',\n      incident_type: 'traffic',\n      start_time: new Date().toISOString(),\n      last_update: new Date().toISOString(),\n      reported_by: '911',\n    },\n  ],\n  police_stations: [\n    { id: 1, name: 'Station 1 - Downtown', city: 'Pittsburgh', county: 'Allegheny', lat: 40.4406, lon: -79.9959, created_at: new Date().toISOString() },\n    { id: 2, name: 'Station 2 - North', city: 'Pittsburgh', county: 'Allegheny', lat: 40.4500, lon: -79.9500, created_at: new Date().toISOString() },\n    { id: 3, name: 'Station 3 - South', city: 'Pittsburgh', county: 'Allegheny', lat: 40.4300, lon: -79.9800, created_at: new Date().toISOString() },\n  ],\n  units: [],\n  dispatches: [],\n  checkpoints: [],\n  unit_stats: [],\n};\n\n// Create three units per station\ndb.police_stations.forEach((station) => {\n  Array.from({ length: 3 }).forEach((_, idx) => {\n    db.units.push({\n      id: `${station.id}-unit-${idx + 1}`,\n      station_id: station.id,\n      unit_number: `Unit ${station.id}-${idx + 1}`,\n      unit_type: idx === 2 ? 'k9' : 'patrol',\n      status: 'available',\n      current_lat: station.lat,\n      current_lon: station.lon,\n      incident_id: null,\n      dispatched_at: null,\n      arrived_at: null,\n      created_at: new Date().toISOString(),\n      updated_at: new Date().toISOString(),\n    });\n  });\n});\n\n// Extra pre-positioned patrols around CMU / Oakland for demo visibility\ndb.units.push(\n  {\n    id: 'patrol-cmu-1',\n    station_id: 1,\n    unit_number: 'Patrol CMU-1',\n    unit_type: 'patrol',\n    status: 'available',\n    current_lat: 40.4445,\n    current_lon: -79.9432,\n    incident_id: null,\n    dispatched_at: null,\n    arrived_at: null,\n    created_at: new Date().toISOString(),\n    updated_at: new Date().toISOString(),\n  },\n  {\n    id: 'traffic-forbes-1',\n    station_id: 1,\n    unit_number: 'Traffic Forbes',\n    unit_type: 'traffic',\n    status: 'available',\n    current_lat: 40.4429,\n    current_lon: -79.9418,\n    incident_id: null,\n    dispatched_at: null,\n    arrived_at: null,\n    created_at: new Date().toISOString(),\n    updated_at: new Date().toISOString(),\n  },\n  {\n    id: 'k9-shadyside',\n    station_id: 2,\n    unit_number: 'K9 Shadyside',\n    unit_type: 'k9',\n    status: 'available',\n    current_lat: 40.4545,\n    current_lon: -79.9320,\n    incident_id: null,\n    dispatched_at: null,\n    arrived_at: null,\n    created_at: new Date().toISOString(),\n    updated_at: new Date().toISOString(),\n  }\n);\n\n// Helper to compute unit_stats view on the fly\nconst computeUnitStats = () => {\n  return db.police_stations.map((ps) => {\n    const units = db.units.filter((u) => u.station_id === ps.id);\n    return {\n      station_id: ps.id,\n      station_name: ps.name,\n      available_units: units.filter((u) => u.status === 'available').length,\n      dispatched_units: units.filter((u) => ['dispatched', 'en_route'].includes(u.status)).length,\n      on_scene_units: units.filter((u) => u.status === 'on_scene').length,\n      total_units: units.length,\n    };\n  });\n};\n\n// Utility clone\nconst clone = <T>(v: T): T => JSON.parse(JSON.stringify(v));\n\n// Reset mock state to initial availability (useful on app load/hot reload)\nexport const resetMockState = () => {\n  db.units = db.units.map((u) => ({\n    ...u,\n    status: 'available',\n    incident_id: null,\n    dispatched_at: null,\n    arrived_at: null,\n    updated_at: new Date().toISOString(),\n  }));\n  db.dispatches = [];\n};\n\n// Query builder\nfunction buildSelect(table: TableName, rows: any[]) {\n  let working = [...rows];\n\n  const api: any = {\n    select: (_cols: string = '*') => api,\n    eq: (col: string, val: any) => {\n      working = working.filter((r) => r[col] === val);\n      return api;\n    },\n    in: (col: string, vals: any[]) => {\n      working = working.filter((r) => vals.includes(r[col]));\n      return api;\n    },\n    order: (col: string, opts: { ascending?: boolean } = {}) => {\n      const asc = opts.ascending !== false;\n      working = [...working].sort((a, b) => {\n        if (a[col] === b[col]) return 0;\n        return (a[col] > b[col] ? 1 : -1) * (asc ? 1 : -1);\n      });\n      return api;\n    },\n    limit: (n: number) => {\n      working = working.slice(0, n);\n      return Promise.resolve({ data: clone(working), error: null });\n    },\n    then: (resolve: any, reject: any) =>\n      Promise.resolve({ data: clone(working), error: null }).then(resolve, reject),\n  };\n\n  return api;\n}\n\nfunction buildUpdate(table: TableName, values: Record<string, any>) {\n  return {\n    eq: (col: string, val: any) => {\n      const updated: any[] = [];\n      db[table] = db[table].map((row) => {\n        if (row[col] === val) {\n          const next = { ...row, ...values, updated_at: new Date().toISOString() };\n          updated.push(next);\n          return next;\n        }\n        return row;\n      });\n      return Promise.resolve({ data: clone(updated), error: null });\n    },\n    in: (col: string, vals: any[]) => {\n      const updated: any[] = [];\n      db[table] = db[table].map((row) => {\n        if (vals.includes(row[col])) {\n          const next = { ...row, ...values, updated_at: new Date().toISOString() };\n          updated.push(next);\n          return next;\n        }\n        return row;\n      });\n      return Promise.resolve({ data: clone(updated), error: null });\n    },\n  };\n}\n\nfunction buildInsert(table: TableName, payload: any | any[]) {\n  const items = Array.isArray(payload) ? payload : [payload];\n  const withIds = items.map((item) => ({\n    ...item,\n    id: item.id || crypto.randomUUID?.() || `id-${Math.random().toString(36).slice(2, 8)}`,\n    created_at: new Date().toISOString(),\n    updated_at: new Date().toISOString(),\n  }));\n  db[table].push(...withIds);\n  return Promise.resolve({ data: clone(withIds), error: null });\n}\n\nfunction buildDelete(table: TableName) {\n  return {\n    eq: (col: string, val: any) => {\n      const removed = db[table].filter((row) => row[col] === val);\n      db[table] = db[table].filter((row) => row[col] !== val);\n      return Promise.resolve({ data: clone(removed), error: null });\n    },\n  };\n}\n\nconst mockChannel = () => {\n  const ch: any = {\n    on: () => ch,\n    subscribe: () => ch,\n    unsubscribe: () => {},\n  };\n  return ch;\n};\n\nexport const supabase: any = {\n  from: (table: TableName) => {\n    if (table === 'unit_stats') {\n      return buildSelect(table, computeUnitStats());\n    }\n    return {\n      select: (_cols: string = '*') => buildSelect(table, db[table]),\n      update: (values: Record<string, any>) => buildUpdate(table, values),\n      insert: (payload: any | any[]) => buildInsert(table, payload),\n      delete: () => buildDelete(table),\n    };\n  },\n  channel: (_name: string) => mockChannel(),\n  removeChannel: (_ch: any) => {},\n  // Expose db for debugging in dev tools\n  __data: db,\n  // Helper to mutate units in-memory (used by animations)\n  __updateUnitPosition: (id: string, lat: number, lon: number, status?: string) => {\n    db.units = db.units.map((u) =>\n      u.id === id\n        ? {\n            ...u,\n            current_lat: lat,\n            current_lon: lon,\n            status: status || u.status,\n            updated_at: new Date().toISOString(),\n          }\n        : u\n    );\n  },\n};\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 356, "column": 0}, "map": {"version":3,"sources":["file:///Users/leonliu/projects/tartanhacks/app/api/incident-state/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { supabase } from '@/lib/supabase-client';\n\nexport async function GET(request: NextRequest) {\n  try {\n    // Fetch active police incidents from Supabase\n    const { data: incidents, error: incidentsError } = await supabase\n      .from('incidents')\n      .select('*')\n      .eq('status', 'active')\n      .order('last_update', { ascending: false });\n\n    if (incidentsError) {\n      return NextResponse.json(\n        { error: 'Failed to fetch incidents', details: incidentsError.message },\n        { status: 500 }\n      );\n    }\n\n    // Fetch police stations\n    const { data: stations, error: stationsError } = await supabase\n      .from('police_stations')\n      .select('*')\n      .order('id');\n\n    if (stationsError) {\n      return NextResponse.json(\n        { error: 'Failed to fetch police stations', details: stationsError.message },\n        { status: 500 }\n      );\n    }\n\n    // Fetch units to check if any are on scene for each incident\n    const { data: allUnits } = await supabase\n      .from('units')\n      .select('incident_id, status')\n      .in('status', ['on_scene']);\n\n    // Create a map of incident_id -> number of units on scene\n    const unitsOnSceneMap = new Map<string, number>();\n    if (allUnits) {\n      allUnits.forEach((u: any) => {\n        if (u.incident_id) {\n          const count = unitsOnSceneMap.get(String(u.incident_id)) || 0;\n          unitsOnSceneMap.set(String(u.incident_id), count + 1);\n        }\n      });\n    }\n\n    // Format incident data with estimated area of concern\n    const formattedIncidents = (incidents || []).map((incident: any) => {\n      // Estimate incident radius based on priority and time since start\n      const startTime = new Date(incident.start_time).getTime();\n      const now = Date.now();\n      const elapsedMinutes = (now - startTime) / (1000 * 60);\n      \n      // Radius based on priority level (in meters)\n      const baseRadius = {\n        'critical': 500, // 500m radius for critical incidents\n        'high': 300,\n        'medium': 200,\n        'low': 100\n      };\n      \n      const radius = baseRadius[incident.priority as keyof typeof baseRadius] || 200;\n      \n      // Check if units are on scene\n      const unitsOnScene = unitsOnSceneMap.get(String(incident.id)) || 0;\n      \n      // Calculate containment effect\n      let estimatedRadius: number;\n      \n      if (unitsOnScene > 0) {\n        // Units are on scene - incident area may be contained\n        const shrinkFactor = 1 - (incident.containment / 100) * 0.8; // Shrink up to 80%\n        estimatedRadius = radius * shrinkFactor;\n      } else {\n        // Incident is still active, may expand slightly\n        const expansionFactor = Math.min(1 + (elapsedMinutes / 60) * 0.1, 1.5); // Max 50% expansion\n        estimatedRadius = radius * expansionFactor;\n      }\n      \n      // Generate simple circular polygon (8 points) for area of concern\n      const polygon_coords = [];\n      const centerLat = incident.lat || 0;\n      const centerLon = incident.lon || 0;\n      \n      for (let i = 0; i < 8; i++) {\n        const angle = (i / 8) * Math.PI * 2;\n        const latOffset = (estimatedRadius / 111320) * Math.cos(angle);\n        const lonOffset = (estimatedRadius / (111320 * Math.cos(centerLat * Math.PI / 180))) * Math.sin(angle);\n        polygon_coords.push([centerLon + lonOffset, centerLat + latOffset]);\n      }\n      // Close the polygon\n      polygon_coords.push(polygon_coords[0]);\n\n      return {\n        id: incident.id,\n        name: incident.name,\n        lat: incident.lat,\n        lon: incident.lon,\n        polygon_coords,\n        estimated_radius: estimatedRadius,\n        priority: incident.priority,\n        containment: incident.containment || 0,\n        last_update: incident.last_update,\n        description: incident.description,\n        incident_type: incident.incident_type,\n        status: incident.status\n      };\n    });\n\n    // Format police station data\n    const formattedStations = (stations || []).map((station: any) => ({\n      id: station.id,\n      name: station.name,\n      lat: station.lat,\n      lon: station.lon,\n      city: station.city,\n      county: station.county,\n      active_route: null // Will be populated when routes are assigned\n    }));\n\n    return NextResponse.json({\n      incidents: formattedIncidents,\n      stations: formattedStations,\n      timestamp: new Date().toISOString(),\n      count: {\n        active_incidents: formattedIncidents.length,\n        stations: formattedStations.length\n      }\n    });\n  } catch (error) {\n    console.error('Incident state API error:', error);\n    return NextResponse.json(\n      { error: 'Internal server error', details: error instanceof Error ? error.message : 'Unknown error' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}